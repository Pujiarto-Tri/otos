{% load humanize %}

<!-- Visitor Dashboard -->
<div class="bg-gradient-to-br from-purple-500 via-blue-500 to-indigo-600 rounded-2xl shadow-xl p-8 mb-8 text-white relative overflow-hidden">
    <div class="absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full transform translate-x-20 -translate-y-20"></div>
    <div class="absolute bottom-0 left-0 w-32 h-32 bg-white/5 rounded-full transform -translate-x-16 translate-y-16"></div>
    
    <div class="relative z-10 text-center">
        <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-sm">
            <span class="text-white text-4xl">🎓</span>
        </div>
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Selamat Datang, Visitor!</h2>
        <p class="text-xl text-white/90 mb-8 max-w-2xl mx-auto">
            Bergabunglah dengan ribuan siswa yang telah merasakan pengalaman belajar terbaik dengan platform tryout online kami.
        </p>
    </div>
</div>

<!-- Subscription Status Alert for Visitors -->
<div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-8 dark:bg-yellow-900/20 dark:border-yellow-800">
    <div class="flex items-center justify-between">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <span class="text-yellow-600 text-2xl">ℹ️</span>
            </div>
            <div class="ml-3">
                <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200">💡 Akses Tryout Terbatas</h3>
                <p class="text-yellow-700 dark:text-yellow-300">Berlangganan untuk mendapatkan akses penuh ke semua fitur tryout online</p>
            </div>
        </div>
        <a href="{% url 'subscription_packages' %}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-yellow-800 bg-yellow-100 hover:bg-yellow-200 rounded-lg dark:bg-yellow-900 dark:text-yellow-300 dark:hover:bg-yellow-800 transition-colors">
            Lihat Paket
        </a>
    </div>
</div>

<!-- Pending Payment Alert -->
{% if pending_payment %}
<div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8 dark:bg-blue-900/20 dark:border-blue-800">
    <div class="flex items-center justify-between">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <span class="text-blue-600 text-2xl">⏳</span>
            </div>
            <div class="ml-3">
                <h3 class="text-lg font-semibold text-blue-800 dark:text-blue-200">⏳ Pembayaran Sedang Diverifikasi</h3>
                <p class="text-blue-700 dark:text-blue-300">Bukti pembayaran untuk {{ pending_payment.package.name }} sedang diverifikasi oleh admin.</p>
            </div>
        </div>
        <a href="{% url 'payment_status' %}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 bg-blue-100 hover:bg-blue-200 rounded-lg dark:bg-blue-900 dark:text-blue-300 dark:hover:bg-blue-800 transition-colors">
            Lihat Status
        </a>
    </div>
</div>
{% endif %}

<!-- Quick Actions & Stats -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg">
        <div class="flex items-center justify-between mb-4">
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Tryout Gratis Diselesaikan</p>
                <h3 class="text-3xl font-bold text-gray-900 dark:text-white">{{ total_free_tests }}</h3>
            </div>
            <span class="w-12 h-12 flex items-center justify-center bg-emerald-100 dark:bg-emerald-900/40 text-emerald-600 dark:text-emerald-300 rounded-full text-xl">✅</span>
        </div>
        <p class="text-sm text-gray-500 dark:text-gray-400">Terus asah kemampuanmu dengan paket gratis yang tersedia.</p>
    </div>
    <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg flex flex-col justify-between">
        <div>
            <p class="text-sm text-gray-500 dark:text-gray-400">Akses semua daftar paket dan subtest</p>
            <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-3">Lanjutkan Latihan Tryout</h3>
        </div>
        <a href="{% url 'tryout_list' %}" class="inline-flex items-center justify-center px-4 py-2 mt-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
            Lihat Semua Tryout
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
            </svg>
        </a>
    </div>
</div>

<!-- Free Packages for Visitors -->
<div class="mb-8">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Paket Tryout Gratis untuk Visitor</h3>
        <span class="text-sm text-gray-500 dark:text-gray-400">Pilih paket gratis dan mulai latihan kapan saja</span>
    </div>
    {% if free_packages %}
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        {% for free_pkg in free_packages %}
        <div class="bg-white dark:bg-gray-900 border border-emerald-200 dark:border-emerald-700/50 rounded-2xl p-6 shadow-sm relative overflow-hidden">
            <span class="absolute top-4 right-4 inline-flex items-center gap-1 text-xs font-semibold bg-emerald-100 text-emerald-700 dark:bg-emerald-900/60 dark:text-emerald-200 px-2.5 py-1 rounded-full">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                </svg>
                Gratis
            </span>
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">{{ free_pkg.package_name }}</h4>
            {% if free_pkg.description %}
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">{{ free_pkg.description|truncatechars:90 }}</p>
            {% endif %}
            <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-4">
                <span>⏱️ {{ free_pkg.total_time }} menit</span>
                <span>📝 {{ free_pkg.get_total_questions }} soal</span>
            </div>
            <a href="{% url 'take_package_test' free_pkg.id %}?force_new=1" class="inline-flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-lg transition">
                Mulai Tryout Gratis
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-gray-50 dark:bg-gray-900/30 border border-dashed border-gray-300 dark:border-gray-700 rounded-2xl p-8 text-center text-gray-600 dark:text-gray-400">
        <p class="text-sm">Belum ada paket gratis yang tersedia saat ini. Pantau terus untuk kesempatan tryout gratis berikutnya.</p>
    </div>
    {% endif %}
</div>

<!-- Recent Free Test Activity -->
<div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-sm p-6 mb-8">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Aktivitas Tryout Gratis Terbaru</h3>
        {% if recent_free_tests %}
        <a href="{% url 'test_history' %}" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">Lihat Riwayat Lengkap</a>
        {% endif %}
    </div>
    {% if recent_free_tests %}
    <div class="space-y-4">
        {% for test in recent_free_tests %}
        <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded-xl px-4 py-3">
            <div>
                <p class="text-sm font-medium text-gray-900 dark:text-white">{{ test.tryout_package.package_name }}</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">Selesai {{ test.date_taken|naturaltime }}</p>
            </div>
            <div class="text-right">
                <p class="text-sm font-semibold text-emerald-600 dark:text-emerald-300">{{ test.score|floatformat:0 }} pts</p>
                <a href="{% url 'test_results' test.id %}" class="text-xs text-indigo-600 hover:text-indigo-500">Lihat Hasil</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-10 text-gray-500 dark:text-gray-400">
        <p>Belum ada aktivitas tryout gratis. Mulai dari paket gratis di atas untuk melihat progresmu di sini!</p>
    </div>
    {% endif %}
</div>

<!-- Featured Subscription Packages -->
{% include 'components/packages/featured_packages.html' with packages=packages %}
