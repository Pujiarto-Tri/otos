{% extends 'base.html' %}
{% load media_helpers %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
            üìÑ Upload Bukti Pembayaran
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-400">
            Upload bukti pembayaran untuk paket <strong>{{ package.name }}</strong>
        </p>
    </div>

    <!-- Package Info -->
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-2xl p-6 mb-8 border border-blue-200 dark:border-blue-800">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-xl font-bold text-gray-900 dark:text-white">{{ package.name }}</h3>
                <p class="text-gray-600 dark:text-gray-400 mt-1">{{ package.description }}</p>
                <div class="flex items-center mt-3">
                    <span class="text-2xl font-bold text-blue-600 dark:text-blue-400">Rp {{ package.price|floatformat:0 }}</span>
                    <span class="text-gray-500 dark:text-gray-400 ml-2">untuk {{ package.duration_days }} hari</span>
                </div>
            </div>
            <div class="hidden md:block">
                {% if package.is_featured %}
                <span class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                    ‚≠ê Terpopuler
                </span>
                {% endif %}
            </div>
        </div>
    </div>

     <!-- Payment Methods Reference -->
    {% if payment_methods %}
    <div class="bg-gray-50 dark:bg-gray-900 rounded-2xl p-6 mt-8">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">üìã Rekening Pembayaran</h3>
        {% regroup payment_methods by payment_type as payment_groups %}
        <div class="grid grid-cols-1 md:grid-cols-{{ payment_groups|length }} gap-4">
            {% for group in payment_groups %}
            <div class="bg-white dark:bg-gray-800 p-4 rounded-lg">
                <h4 class="font-semibold text-gray-900 dark:text-white flex items-center mb-3">
                    {% if group.grouper == 'bank' %}
                    <svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    Transfer Bank
                    {% elif group.grouper == 'ewallet' %}
                    <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                    </svg>
                    E-Wallet
                    {% else %}
                    <svg class="w-5 h-5 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                    </svg>
                    {{ group.list.0.get_payment_type_display }}
                    {% endif %}
                </h4>
                {% for method in group.list %}
                <div class="{% if not forloop.last %}mb-2{% endif %}">
                    <p class="text-sm font-medium text-gray-900 dark:text-white">{{ method.name }}: {{ method.account_number }}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">a.n. {{ method.account_name }}</p>
                </div>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    <!-- Payment Form -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-8">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="space-y-6">
                <!-- Package (readonly) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Paket yang Dipilih
                    </label>
                    <input type="text" value="{{ package.name }}" disabled 
                           class="bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg block w-full p-2.5">
                    {{ form.package.as_hidden }}
                </div>

                <!-- Amount (readonly) -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Jumlah Pembayaran
                    </label>
                    <input type="text" value="Rp {{ package.price|floatformat:0 }}" disabled 
                           class="bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white text-sm rounded-lg block w-full p-2.5">
                    {{ form.amount_paid.as_hidden }}
                </div>

                <!-- Payment Method -->
                <div>
                    <label for="{{ form.payment_method.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Metode Pembayaran <span class="text-red-500">*</span>
                    </label>
                    {{ form.payment_method }}
                    {% if form.payment_method.errors %}
                        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.payment_method.errors.0 }}</p>
                    {% endif %}
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Contoh: Transfer Bank BCA, OVO, GoPay, dll</p>
                </div>

                <!-- Payment Date -->
                <div>
                    <label for="{{ form.payment_date.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Tanggal & Waktu Pembayaran <span class="text-red-500">*</span>
                    </label>
                    {{ form.payment_date }}
                    {% if form.payment_date.errors %}
                        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.payment_date.errors.0 }}</p>
                    {% endif %}
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Kapan Anda melakukan pembayaran</p>
                </div>

                <!-- Proof Image -->
                <div>
                    <label for="{{ form.proof_image.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Bukti Pembayaran <span class="text-red-500">*</span>
                    </label>
                    {{ form.proof_image }}
                    {% if form.proof_image.errors %}
                        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.proof_image.errors.0 }}</p>
                    {% endif %}
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">{{ form.proof_image.help_text }}</p>
                </div>

                <!-- Notes -->
                <div>
                    <label for="{{ form.notes.id_for_label }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Catatan (Opsional)
                    </label>
                    {{ form.notes }}
                    {% if form.notes.errors %}
                        <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.notes.errors.0 }}</p>
                    {% endif %}
                    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Catatan tambahan mengenai pembayaran</p>
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 mt-8">
                <button type="submit" 
                        class="flex-1 inline-flex items-center justify-center px-6 py-3 text-base font-medium text-white bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    Upload Bukti Pembayaran
                </button>
                <a href="{% url 'subscription_packages' %}" 
                   class="flex-1 inline-flex items-center justify-center px-6 py-3 text-base font-medium text-gray-700 dark:text-gray-300 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded-xl transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                    </svg>
                    Kembali
                </a>
            </div>
        </form>
    </div>

    <!-- Instructions -->
    <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-2xl p-6 mt-8">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <svg class="w-6 h-6 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <div class="ml-3">
                <h3 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200">üí° Tips Upload Bukti Pembayaran</h3>
                <ul class="mt-2 text-yellow-700 dark:text-yellow-300 space-y-1">
                    <li>‚Ä¢ Pastikan screenshot jelas dan dapat dibaca</li>
                    <li>‚Ä¢ Tampilkan nominal pembayaran, tanggal, dan tujuan transfer</li>
                    <li>‚Ä¢ Format file: JPG, PNG (max 5MB)</li>
                    <li>‚Ä¢ Verifikasi biasanya memakan waktu 1x24 jam</li>
                    <li>‚Ä¢ Anda akan mendapat notifikasi setelah verifikasi selesai</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
