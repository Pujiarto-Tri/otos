{% load tz %}
{% if broadcasts %}
<div class="mb-8 space-y-4">
    {% for item in broadcasts %}
    <div class="relative overflow-hidden rounded-xl border border-amber-200 bg-amber-50 shadow-sm dark:border-amber-600/40 dark:bg-amber-900/30">
        <div class="flex flex-col gap-3 px-5 py-4 sm:flex-row sm:items-start sm:justify-between">
            <div>
                <div class="flex items-center gap-2">
                    <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-amber-500/90 text-white shadow-inner">
                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-.01-8h.01M5.4 19h13.2a1 1 0 00.9-1.45L12.9 4.55a1 1 0 00-1.8 0L4.5 17.55A1 1 0 005.4 19z" />
                        </svg>
                    </span>
                    <h3 class="text-base font-semibold text-amber-900 dark:text-amber-100">{{ item.title }}</h3>
                </div>
                <div class="mt-2 text-sm leading-relaxed text-amber-900/90 dark:text-amber-100/90 whitespace-pre-line">
                    {{ item.content }}
                </div>
                <div class="mt-3 flex flex-wrap items-center gap-3 text-xs text-amber-800/80 dark:text-amber-200/80">
                    {% if item.expires_at %}
                    <span class="inline-flex items-center gap-1 rounded-full bg-amber-100/80 px-3 py-1 dark:bg-amber-800/50">
                        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Hingga {{ item.expires_at|localtime|date:"d M Y H:i" }} WITA
                    </span>
                    {% endif %}
                    {% with roles=item.target_roles.all %}
                        {% if roles %}
                        <span class="inline-flex items-center gap-1 rounded-full bg-amber-100/80 px-3 py-1 dark:bg-amber-800/50">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-3.5 w-3.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                            </svg>

                            {{ item.target_role_names }}
                        </span>
                        {% endif %}
                    {% endwith %}
                    {% if item.students_require_active_subscription %}
                    <span class="inline-flex items-center gap-1 rounded-full bg-amber-100/80 px-3 py-1 dark:bg-amber-800/50">
                        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Khusus siswa dengan langganan aktif
                    </span>
                    {% endif %}
                </div>
            </div>
            {% if user.is_authenticated %}
                {% if user.is_admin or user.is_operator %}
                <div class="flex flex-col items-end gap-2 text-xs text-amber-900/70 dark:text-amber-200/80">
                    <span class="inline-flex items-center gap-1 rounded-full bg-white/80 px-2 py-1 shadow-sm ring-1 ring-amber-200 dark:bg-amber-900/40 dark:ring-amber-700/60">
                        Status: 
                        {% if item.is_live %}
                            <span class="font-semibold text-emerald-600 dark:text-emerald-300">Tayang</span>
                        {% elif item.is_upcoming %}
                            <span class="font-semibold text-blue-600 dark:text-blue-300">Terjadwal</span>
                        {% else %}
                            <span class="font-semibold text-red-600 dark:text-red-300">Berakhir</span>
                        {% endif %}
                    </span>
                    <a href="{% url 'admin_broadcast_edit' item.id %}" class="inline-flex items-center gap-1 rounded-lg bg-amber-500/90 px-3 py-1.5 text-xs font-semibold text-white shadow hover:bg-amber-500 focus:outline-none focus:ring-2 focus:ring-amber-400">
                        Kelola
                    </a>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
