{% extends 'base.html' %}

{% block title %}Tryout - Pilih Subtest atau Paket{% endblock %}

{% block content %}
<style>
.modal-backdrop {
    backdrop-filter: blur(4px);
}

.tryout-card {
    --card-bg: #f9fafb;
    --card-bg-dark: rgba(15,23,42,0.82);
    --card-border-start: rgba(59,130,246,0.45);
    --card-border-end: rgba(129,140,248,0.25);
    --card-border-strong: rgba(99,102,241,0.95);
    --outer-glow: rgba(99,102,241,0.45);
    position: relative;
    border-radius: 0.75rem;
    background: var(--card-bg);
    border: 1.5px solid transparent;
    border-image: linear-gradient(135deg, var(--card-border-start), var(--card-border-end)) 1;
    box-shadow: 0 20px 40px -30px var(--card-border-start);
    transition: transform 220ms ease, box-shadow 220ms ease, border-image 220ms ease;
}

.dark .tryout-card {
    background: var(--card-bg-dark);
    box-shadow: 0 24px 48px -32px rgba(15,23,42,0.85);
}

.tryout-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    border: 1.5px solid rgba(255,255,255,0.35);
    opacity: 0.18;
    pointer-events: none;
}

.dark .tryout-card::before {
    border-color: rgba(255,255,255,0.08);
}

.tryout-card::after {
    content: "";
    position: absolute;
    inset: -16px;
    border-radius: inherit;
    background: radial-gradient(60% 70% at 50% 50%, var(--outer-glow), transparent 72%);
    opacity: 0;
    filter: blur(10px);
    transition: opacity 220ms ease, transform 220ms ease;
    pointer-events: none;
    z-index: -1;
}

.tryout-card:hover {
    transform: translateY(-4px);
    border-image: linear-gradient(135deg, var(--card-border-strong), rgba(255,255,255,0.2)) 1;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.12), 0 26px 58px -28px var(--card-border-strong);
}

.tryout-card:hover::after {
    opacity: 0.68;
    transform: scale(1.02);
}

.tryout-card--package {
    --card-bg: #f1f9f4;
    --card-bg-dark: linear-gradient(160deg, rgba(15,118,110,0.28), rgba(21,128,61,0.12));
    --card-border-start: rgba(34,197,94,0.55);
    --card-border-end: rgba(16,185,129,0.28);
    --card-border-strong: rgba(34,197,94,0.95);
    --outer-glow: rgba(34,197,94,0.55);
}

.tryout-card--subtest {
    --card-bg: #edf2ff;
    --card-bg-dark: linear-gradient(160deg, rgba(37,99,235,0.24), rgba(79,70,229,0.12));
    --card-border-start: rgba(59,130,246,0.55);
    --card-border-end: rgba(129,140,248,0.3);
    --card-border-strong: rgba(59,130,246,0.95);
    --outer-glow: rgba(59,130,246,0.55);
}

</style>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-16">
    <!-- Header Section -->
    <div class="text-center mb-10">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4">
            ðŸŽ¯ Pilih Tryout
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
            Uji kemampuan Anda dengan paket simulasi UTBK atau latihan per subtest
        </p>
    </div>
    <!-- Search and Filter Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
            <!-- Search Form -->
            <form method="get" action="" role="search" class="flex-1 max-w-md">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <input type="text" name="q" id="search" value="{{ search_query }}" 
                        placeholder="Cari paket atau subtest..."
                        class="block w-full pl-10 pr-20 py-2 text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500" />
                    <button type="submit"
                        class="absolute top-0 right-0 p-2 text-sm font-medium text-white bg-blue-700 rounded-r-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
            </form>
            
            <!-- Sort Filter -->
            <form method="get" action="" class="flex items-center gap-3">
                <input type="hidden" name="q" value="{{ search_query }}" />
                <label for="sort" class="text-sm font-medium text-gray-700 dark:text-gray-300">Urutkan:</label>
                <select id="sort" name="sort" onchange="this.form.submit()"
                    class="px-3 py-2 text-sm text-gray-900 dark:text-white bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-300 dark:border-gray-600 focus:ring-blue-500 focus:border-blue-500">
                    <option value="" {% if not sort_option %}selected{% endif %}>Default</option>
                    <option value="newest" {% if sort_option == 'newest' %}selected{% endif %}>Terbaru</option>
                    <option value="alphabet" {% if sort_option == 'alphabet' %}selected{% endif %}>A-Z</option>
                    <option value="method" {% if sort_option == 'method' %}selected{% endif %}>Metode</option>
                </select>
            </form>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="flex justify-center mb-8">
        <div class="bg-gray-100 dark:bg-gray-800 p-1 rounded-lg">
            <button id="packages-tab" 
                class="px-6 py-2 text-sm font-medium rounded-md transition-colors text-white bg-gradient-to-r from-green-500 to-emerald-600 shadow-lg" 
                onclick="showTab('packages')">
                ðŸ“¦ Paket Simulasi UTBK
            </button>
            <button id="categories-tab" 
                class="px-6 py-2 text-sm font-medium rounded-md transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-50 dark:hover:bg-gray-700" 
                onclick="showTab('categories')">
                ðŸ“š Paket Subtest
            </button>
        </div>
    </div>

        <!-- Packages Section -->
        <div id="packages-section" class="tab-content">
            {% if packages %}
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">ðŸ“¦ Paket Simulasi UTBK</h2>
                <p class="text-gray-600 dark:text-gray-400">
                    Simulasi lengkap dengan komposisi subtest seperti ujian UTBK sesungguhnya
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for package in packages %}
                {% load tz %}
                {% now "Y-m-d" as today %}
                {% with package.release_date|date:"Y-m-d" as release_day %}
                {% with package.release_date|timesince as time_since %}
                <div class="tryout-card tryout-card--package max-w-sm p-6 rounded-xl group relative overflow-visible transition-transform duration-300">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-4">
                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300">PAKET UTBK</span>
                        {% if time_since|slice:":7" == "0 menit" or time_since|slice:":6" == "1 hari" or time_since|slice:":7" == "2 hari" %}
                        <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">âœ¨ BARU!</span>
                        {% endif %}
                    </div>
                    
                    <!-- Title -->
                    <h5 class="mb-2 text-xl font-bold tracking-tight text-gray-900 dark:text-white">{{ package.package_name }}</h5>
                    
                    <!-- Description -->
                    {% if package.description %}
                    <p class="mb-3 font-normal text-gray-700 dark:text-gray-400 text-sm">{{ package.description|truncatechars:80 }}</p>
                    {% endif %}
                    
                    <!-- Release Info -->
                    <p class="mb-3 text-xs text-gray-500 dark:text-gray-400">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Dirilis {{ time_since }} yang lalu ({{ package.release_date|date:"d M Y" }})
                    </p>
                    
                    <!-- Stats -->
                    <div class="mb-4 grid grid-cols-3 gap-2 text-center">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-2">
                            <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ package.get_total_questions }}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Soal</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-2">
                            <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ package.total_time }}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Menit</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-2">
                            <div class="text-sm font-semibold {% if package.is_scoring_complete %}text-green-600 dark:text-green-400{% else %}text-orange-600 dark:text-orange-400{% endif %}">
                                {{ package.get_total_max_score|floatformat:0 }}
                            </div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Poin</div>
                        </div>
                    </div>
                    
                    <!-- Categories -->
                    <div class="mb-4">
                        <h6 class="text-sm font-medium text-gray-900 dark:text-white mb-2">Komposisi Subtest:</h6>
                        <div class="space-y-1">
                            {% for package_category in package.tryoutpackagecategory_set.all %}
                            <div class="flex justify-between text-xs text-gray-600 dark:text-gray-400">
                                <span>{{ package_category.category.category_name }}</span>
                                <span class="font-medium">{{ package_category.max_score }} poin</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Action Button -->
                    {% if package.can_be_taken %}
                    <button type="button" onclick="showStartWarning(this)"
                        data-url="{% url 'take_package_test' package.id %}?force_new=1"
                        data-title="Paket UTBK: {{ package.package_name }}"
                        data-questions="{{ package.get_total_questions }}"
                        data-time="{{ package.total_time }}"
                        class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                        Mulai Tryout
                        <svg class="rtl:rotate-180 w-3.5 h-3.5 ms-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 14 10">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M1 5h12m0 0L9 1m4 4L9 9"/>
                        </svg>
                    </button>
                    {% else %}
                    <div class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-orange-800 bg-orange-100 rounded-lg dark:text-orange-300 dark:bg-orange-900">
                        <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Paket Belum Siap
                    </div>
                    {% endif %}
                </div>
                {% endwith %}
                {% endwith %}
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-20">
                <div class="mx-auto w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-3xl flex items-center justify-center mb-6 shadow-lg">
                    <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504 1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-3">Belum Ada Paket Tryout</h3>
                <p class="text-gray-500 dark:text-gray-400 max-w-md mx-auto leading-relaxed">
                    Paket simulasi UTBK sedang dalam persiapan. Silakan coba paket subtest untuk latihan individual.
                </p>
            </div>
            {% endif %}
        </div>

        <!-- Categories Section -->
        <div id="categories-section" class="tab-content hidden">
            {% if categories %}
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">ðŸ“š Paket Subtest</h2>
                <p class="text-gray-600 dark:text-gray-400">
                    Latihan per subtest untuk memperdalam kemampuan spesifik
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for category in categories %}
                {% load tz %}
                {% now "Y-m-d" as today %}
                {% with category.release_date|date:"Y-m-d" as release_day %}
                {% with category.release_date|timesince as time_since %}
                <div class="tryout-card tryout-card--subtest max-w-sm p-6 rounded-xl group relative overflow-visible transition-transform duration-300">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-4">
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">SUBTEST</span>
                        {% if time_since|slice:":7" == "0 menit" or time_since|slice:":6" == "1 hari" or time_since|slice:":7" == "2 hari" %}
                        <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">âœ¨ BARU!</span>
                        {% endif %}
                    </div>
                    
                    <!-- Title -->
                    <h5 class="mb-2 text-xl font-bold tracking-tight text-gray-900 dark:text-white">{{ category.category_name }}</h5>
                    
                    <!-- Release Info -->
                    <p class="mb-3 text-xs text-gray-500 dark:text-gray-400">
                        <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        Dirilis {{ time_since }} yang lalu ({{ category.release_date|date:"d M Y" }})
                    </p>
                    
                    <!-- Stats -->
                    <div class="mb-4 grid grid-cols-3 gap-2 text-center">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-2">
                            <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ category.question_set.count }}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Soal</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-2">
                            <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ category.time_limit }}</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Menit</div>
                        </div>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded p-2">
                            <div class="text-sm font-semibold text-gray-900 dark:text-white">{{ category.passing_score|floatformat:0 }}%</div>
                            <div class="text-xs text-gray-500 dark:text-gray-400">Pass</div>
                        </div>
                    </div>
                    
                    <!-- Action Button -->
                    {% if category.question_set.count > 0 %}
                    <button type="button" onclick="showStartWarning(this)"
                        data-url="{% url 'take_test' category.id 1 %}?force_new=1"
                        data-title="Subtest: {{ category.category_name }}"
                        data-questions="{{ category.question_set.count }}"
                        data-time="{{ category.time_limit }}"
                        class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                        Mulai Latihan
                        <svg class="rtl:rotate-180 w-3.5 h-3.5 ms-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 14 10">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M1 5h12m0 0L9 1m4 4L9 9"/>
                        </svg>
                    </button>
                    {% else %}
                    <div class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-red-800 bg-red-100 rounded-lg dark:text-red-300 dark:bg-red-900">
                        <svg class="w-3 h-3 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Belum Ada Soal
                    </div>
                    {% endif %}
                </div>
                {% endwith %}
                {% endwith %}
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-20">
                <div class="mx-auto w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600 rounded-3xl flex items-center justify-center mb-6 shadow-lg">
                    <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-semibold text-gray-900 dark:text-white mb-3">Belum Ada Subtest</h3>
                <p class="text-gray-500 dark:text-gray-400 max-w-md mx-auto leading-relaxed">
                    Subtest latihan belum tersedia. Silakan coba paket simulasi UTBK untuk pengalaman tryout lengkap.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Start Warning Modal -->
<div id="startTestModal" class="fixed inset-0 bg-gray-900/50 modal-backdrop hidden overflow-y-auto h-full w-full z-50">
    <div class="relative top-10 mx-auto p-5 w-11/12 md:w-2/3 lg:w-1/2 xl:w-2/5">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden animate-fadeIn">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-amber-500 to-orange-500 p-6 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl mr-4">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold">Konfirmasi Memulai Tryout</h3>
                            <p class="text-amber-100 text-sm">Pastikan Anda sudah siap</p>
                        </div>
                    </div>
                    <button onclick="hideStartWarning()" class="text-white/70 hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Modal Content -->
            <div class="p-8">
                <!-- Tryout Info -->
                <div class="text-center mb-8">
                    <h4 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                        <span id="modal-category-name"></span>
                    </h4>
                    <p class="text-gray-600 dark:text-gray-400">Anda akan memulai tryout subtest ini</p>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 rounded-xl p-4 text-center border border-blue-200 dark:border-blue-700">
                        <div class="flex items-center justify-center w-10 h-10 bg-blue-500 rounded-lg mx-auto mb-2">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <p class="text-2xl font-bold text-blue-700 dark:text-blue-300"><span id="modal-question-count"></span></p>
                        <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">Total Soal</p>
                    </div>

                    <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 rounded-xl p-4 text-center border border-green-200 dark:border-green-700">
                        <div class="flex items-center justify-center w-10 h-10 bg-green-500 rounded-lg mx-auto mb-2">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <p class="text-2xl font-bold text-green-700 dark:text-green-300"><span id="modal-time-limit"></span></p>
                        <p class="text-sm text-green-600 dark:text-green-400 font-medium">Menit</p>
                    </div>
                </div>

                <!-- Warning Box -->
                <div class="bg-amber-50 dark:bg-amber-900/30 border-l-4 border-amber-400 dark:border-amber-500 p-6 mb-8 rounded-r-xl">
                    <div class="flex items-start">
                        <svg class="w-6 h-6 text-amber-500 mt-0.5 mr-4 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h5 class="text-lg font-semibold text-amber-800 dark:text-amber-200 mb-3">Perhatian Penting!</h5>
                            <ul class="space-y-2 text-sm text-amber-700 dark:text-amber-300">
                                <li class="flex items-start"><svg class="w-4 h-4 text-amber-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>Disarankan untuk menggunakan Komputer/Laptop atau Tablet/Ipad</li>
                                <li class="flex items-start"><svg class="w-4 h-4 text-amber-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>Timer akan mulai berjalan segera setelah Anda mengklik "Mulai Sekarang"</li>
                                <li class="flex items-start"><svg class="w-4 h-4 text-amber-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>Anda dapat keluar dan masuk kembali, namun timer tetap berjalan</li>
                                <li class="flex items-start"><svg class="w-4 h-4 text-amber-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>Ujian akan otomatis berakhir ketika waktu habis</li>
                                <li class="flex items-start"><svg class="w-4 h-4 text-amber-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg>Pastikan koneksi internet Anda stabil</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Ready Check -->
                <div class="text-center mb-8">
                    <p class="text-lg text-gray-600 dark:text-gray-400 mb-4">Apakah Anda sudah siap untuk memulai tryout ini?</p>
                        <button id="confirm-read-btn" type="button" class="inline-flex items-center px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-full text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors" aria-pressed="false" aria-describedby="confirm-read-hint">
                            <svg id="confirm-read-icon" class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display:none;"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                            <span id="confirm-read-text">Saya sudah membaca semua informasi</span>
                        </button>
                        <div id="confirm-read-hint" class="mt-2 text-xs text-gray-500 dark:text-gray-400">Tombol "Mulai Sekarang" akan aktif setelah konfirmasi.</div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="hideStartWarning()" class="px-8 py-3 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 text-base font-semibold rounded-xl hover:bg-gray-300 dark:hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-all duration-300 flex items-center justify-center"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>Batal</button>
                    <button id="start-now-button" onclick="startTryout()" class="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-base font-semibold rounded-xl hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-xl"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>Mulai Sekarang<svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"></path></svg></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Tab navigation with updated styling
function showTab(tabName) {
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.add('hidden'));
    document.getElementById(tabName + '-section').classList.remove('hidden');
    
    const tabs = document.querySelectorAll('#packages-tab, #categories-tab');
    tabs.forEach(tab => {
        const active = tab.id === tabName + '-tab';
        if (active) {
            // Active tab styling
            tab.classList.remove('text-gray-600', 'dark:text-gray-400', 'hover:text-gray-900', 'dark:hover:text-white', 'hover:bg-gray-50', 'dark:hover:bg-gray-700');
            if (tabName === 'packages') {
                // For packages tab, use green gradient when active
                tab.classList.add('text-white', 'bg-gradient-to-r', 'from-green-500', 'to-emerald-600', 'shadow-lg');
            } else {
                // For categories tab, use blue gradient when active
                tab.classList.add('text-white', 'bg-gradient-to-r', 'from-blue-500', 'to-indigo-600', 'shadow-lg');
            }
        } else {
            // Inactive tab styling
            if (tabName === 'packages' && tab.id === 'categories-tab') {
                // Categories tab when packages is active
                tab.classList.add('text-gray-600', 'dark:text-gray-400', 'hover:text-gray-900', 'dark:hover:text-white', 'hover:bg-gray-50', 'dark:hover:bg-gray-700');
                tab.classList.remove('text-white', 'bg-gradient-to-r', 'from-blue-500', 'to-indigo-600', 'shadow-lg');
            } else if (tabName === 'categories' && tab.id === 'packages-tab') {
                // Packages tab when categories is active
                tab.classList.add('text-gray-600', 'dark:text-gray-400', 'hover:text-gray-900', 'dark:hover:text-white', 'hover:bg-gray-50', 'dark:hover:bg-gray-700');
                tab.classList.remove('text-white', 'bg-gradient-to-r', 'from-green-500', 'to-emerald-600', 'shadow-lg');
            }
        }
    });
}

// Initialize tabs on load
document.addEventListener('DOMContentLoaded', () => showTab('packages'));

// Custom Start Warning Modal functions
function showStartWarning(button) {
    console.log('showStartWarning called', button);
    const title = button.getAttribute('data-title');
    const questions = button.getAttribute('data-questions');
    const time = button.getAttribute('data-time');
    const url = button.getAttribute('data-url');
    
    console.log('Modal data:', { title, questions, time, url });
    console.log('DEBUGGING: URL should be take_test, not admin URL:', url);
    
    document.getElementById('modal-category-name').textContent = title;
    document.getElementById('modal-question-count').textContent = questions;
    document.getElementById('modal-time-limit').textContent = time;
    document.getElementById('start-now-button').setAttribute('data-url', url);
    document.getElementById('startTestModal').classList.remove('hidden');
}

function hideStartWarning() {
    console.log('hideStartWarning called');
    document.getElementById('startTestModal').classList.add('hidden');
}

function startTryout() {
    const url = document.getElementById('start-now-button').getAttribute('data-url');
    console.log('Starting tryout with URL:', url);
    console.log('DEBUGGING: This should be /students/tryouts/ID/take/1/ format:', url);
    
    // Add error handling for the redirect
    try {
        if (url) {
            console.log('Redirecting to:', url);
            window.location.href = url;
        } else {
            console.error('No URL found for redirect');
            alert('Error: Tidak dapat memulai tryout. URL tidak ditemukan.');
        }
    } catch (error) {
        console.error('Error during redirect:', error);
        alert('Error: Terjadi kesalahan saat memulai tryout.');
    }
}

// Close modal when clicking outside
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('startTestModal');
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            hideStartWarning();
        }
    });
    
    // Confirmation flow: require user to confirm they read info before enabling start
    const confirmBtn = document.getElementById('confirm-read-btn');
    const confirmIcon = document.getElementById('confirm-read-icon');
    const confirmText = document.getElementById('confirm-read-text');
    const startNowBtn = document.getElementById('start-now-button');

    function setConfirmed(confirmed) {
        confirmBtn.setAttribute('aria-pressed', confirmed ? 'true' : 'false');
        if (confirmed) {
            confirmBtn.classList.remove('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            confirmBtn.classList.add('bg-green-100', 'text-green-700', 'dark:bg-green-900/30', 'dark:text-green-300');
            confirmIcon.style.display = 'inline-block';
            confirmText.textContent = 'Dikonfirmasi: Siap memulai';
            // enable start button
            startNowBtn.removeAttribute('disabled');
            startNowBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            confirmBtn.classList.add('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            confirmBtn.classList.remove('bg-green-100', 'text-green-700', 'dark:bg-green-900/30', 'dark:text-green-300');
            confirmIcon.style.display = 'none';
            confirmText.textContent = 'Saya sudah membaca semua informasi';
            // disable start button
            startNowBtn.setAttribute('disabled', 'disabled');
            startNowBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
    }

    // initialize disabled state
    setConfirmed(false);

    confirmBtn.addEventListener('click', function() {
        const pressed = confirmBtn.getAttribute('aria-pressed') === 'true';
        setConfirmed(!pressed);
    });

    // reset confirmation when opening modal
    const originalShowStartWarning = showStartWarning;
    window.showStartWarning = function(button) {
        // reset confirm state each time modal opens
        setConfirmed(false);
        // set modal data and show
        originalShowStartWarning(button);
    };
    
    // also reset when modal closed
    const closeButtons = document.querySelectorAll('[onclick="hideStartWarning()"]');
    closeButtons.forEach(btn => btn.addEventListener('click', function() { setConfirmed(false); }));
});
</script>

{% endblock %}
